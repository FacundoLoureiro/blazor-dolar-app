@page "/"
@using System.Text.Json
@using BlazorDolarApp.Services
@using BlazorDolarApp.Models
@inject DolaresServices DolaresServices
@inject ISnackbar Snackbar

@if (!string.IsNullOrEmpty(errorMessage))
{
    <MudAlert Severity="Severity.Error" Class="my-2">@errorMessage</MudAlert>
}
<MudTable Items="@dolarList.Take(2)" Hover="true" Breakpoint="Breakpoint.Sm" Loading="@_loading" LoadingProgressColor="Color.Info">
    <HeaderContent>
        <MudTh>Dolar</MudTh>
        <MudTh>Compra</MudTh>
        <MudTh>Venta</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Tipo de Dólar">@context.Moneda</MudTd>
            <MudTd DataLabel="Compra">@context.Compra</MudTd>
            <MudTd DataLabel="Venta">@context.Venta</MudTd>
        </RowTemplate>      
    </MudTable>
    @code {
    private List<Dolares> dolarList = new List<Dolares>();
    private bool _loading = true;
    private string errorMessage = "";

    protected override async Task OnInitializedAsync()
    {
        try
    {
        _loading = true;
        string dolares = await DolaresServices.GetDolarOficialAsync();
        var dolarOficial = JsonSerializer.Deserialize<Dolares>(dolares);
        if (dolarOficial != null)
        {
            dolarOficial.Moneda = "Dolar Oficial";
            dolarList.Add(dolarOficial);
        }
    }
    catch (Exception ex)
    {
        errorMessage = $"Error al cargar datos: {ex.Message}";
        Snackbar.Add(errorMessage, Severity.Error);
        
    }
    finally
    {
        _loading = false;
    }
  }
}